# Repository Guidelines

## Project Structure & Modules
- `src/`: TypeScript source. Folders: `components/` (React UI, PascalCase), `hooks/`, `store/`, `lib/`, `types/`, and test helpers in `src/test/`.
- Build artifacts: `main.js`, `manifest.json`, `styles.css` at repo root (Obsidian loads these).
- Config: `esbuild.config.mjs`, `tsconfig.json`, `biome.json`, `vitest.config.ts`.
- Docs and reports: `docs/`, `coverage/` (generated by tests).

## Build, Test, and Dev
- Use Bun to execute scripts. Prefer `bun run <script>` instead of `npm run`.
- `bun run dev`: Watch build for local development; writes `main.js` for Obsidian.
- `bun run build`: Type-checks and produces a production build.
- `bun run check`: Type-check only (no emit).
- `bun run test` / `bun run test:watch`: Run Vitest once / in watch mode.
- `bun run test:coverage`: Generate coverage report in `coverage/`.
- Tip: Point Obsidian to this folder as a community plugin; toggle the plugin to reload your local build.

## Coding Style & Naming
- Language: TypeScript + React. Indentation: 2 spaces.
- Components: PascalCase in `src/components` (e.g., `CardViewHeader.tsx`).
- Utilities, hooks, stores: camelCase (e.g., `dateUtils.ts`, `useCardViewState.ts`).
- Tests: colocated `*.test.ts(x)` next to sources.
- Lint/format: Biome. Use `bun run lint`, `bun run format`, or `bun run check-all` before pushing.
- Imports: group Node built-ins → external → internal → relative; blank line between groups; sort within groups; prefer `import type` for types.
- File names/exports: one React component per file; avoid default exports; non-React modules use descriptive camelCase names.
- React: functional components only; props interface named `<Component>Props`; memoize props-passed callbacks/values with `useCallback`/`useMemo`; avoid derived state in `useEffect`.
- TypeScript: `strict` enabled; avoid `any`; prefer discriminated unions; use `readonly`/`const`; handle `null`/`undefined` explicitly.
- Formatting: line width 100, double quotes, semicolons, trailing commas `es5` (Biome).

## Testing Guidelines
- Framework: Vitest with jsdom and Testing Library.
- Setup: `src/test/setup.ts`, Obsidian mocks in `src/test/obsidian-mock.ts`.
- Aim to maintain or improve coverage; unit test components, hooks, and store logic.
- Example: `bun run test:watch` while iterating on `src/components/NoteCard.tsx`.
- Sandbox note: Due to sandbox constraints, run tests with VM Threads for stability; use `--pool=vmThreads` when invoking Vitest (other suites benefit similarly).

## Commit & PR Guidelines
- Commits: Conventional Commits with scope when helpful, e.g. `feat(ObsidianIcon): add component`, `refactor(test): simplify factory`.
- PRs include: clear description, linked issue, screenshots/GIFs for UI, and testing notes.
- Before PR: run build, lint, format, tests; if versioning, use `bun run version` to update `manifest.json`/`versions.json`.

## Runtime and Tooling
- Package runner: Bun. Avoid using `npm`/`npx` for script execution.
- All script invocations in docs, tests, and CI should use `bun run <script>`.

## Agent Operating Policy
- Do not run `git commit` or `git push` unless explicitly instructed by the user.
- Before any commit, present (1) a concise change summary and (2) a proposed English commit message; proceed only after approval.
- Do not perform history operations (`reset`, `rebase`, `revert`, `amend`) without explicit instruction.
- For destructive actions or operations requiring elevated privileges or network access, explain the purpose and request approval before running.

## Security & Configuration
- Do not commit personal vault content. Only plugin code and required build artifacts.
- Avoid privileged Obsidian APIs without guards; prefer typed helpers in `src/lib/` and mocks in tests.
